Project toitsu-view
=========

Το πρότυπο για τα front-end projects της OTS.

Τεχνολογίες
-----------

* AngularJS
* NPM (Package manager)
* Gulp (Build system)
* Bootstrap

## Development environment setup

Για να μπορέσει κάποιος να συνεισφέρει σε αυτό το project, χρειάζεται να έχει εγκατεστημένα τα ακόλουθα προγράμματα στο περιβάλλον ανάπτυξής του. Τα παρακάτω βήματα έχουν δοκιμαστεί σε περιβάλλον Windows 7 και Windows 10.

1. Εγκατάσταση του [NodeJS](http://nodejs.org/). Με την εγκατάσταση, δημιουργείται νέο command prompt (Node.js command prompt), το οποίο θα χρησιμοποιήσετε για να διαχειριστείτε το project.
   > Σημείωση: Αν δεν έχετε δικαιώματα διαχειριστή, υπάρχει ενδεχόμενο να πρέπει να ανοίξει το Node.js command prompt ως διαχειριστής.
1. Εγκατάσταση [Git](https://msysgit.github.io/) client. Από το git-bash μπορείτε να διαχειριστείτε το project με οτιδήποτε σχετίζεται με το gitlab (clone, push, κτλ). Προσθήκη του ```$GIT_ROOT\bin``` (αντικαθιστάτε το ```$GIT_ROOT``` με το path στο οποίο έχει εγκατασταθεί το Git) στη μεταβλητή συστήματος ```PATH```.
1. Εγκατάσταση και άνοιγμα κονσόλας [cmder](http://cmder.net/) για windows (ΔΕΝ ΕΙΝΑΙ ΥΠΟΧΡΕΩΤΙΚΟ).

Από το command prompt του Node.js ελέγχουμε:
   1. Έλεγχος σωστής εγκατάστασης όλων των παραπάνω:
      ```bash
      node -v && npm --version && git --version
      ```
      
      Εφόσον έχει γίνει σωστή εγκατάσταση θα πρέπει να εμφανιστούν τρεις διαφορετικές εκδόσεις. Το output θα μοιάζει περίπου όπως το παρακάτω:
      ```
      v8.11.4
      5.6.0
      git version 2.11.0.windows.3
      ```

## Development

Εκτελώντας τα παραπάνω και στην συνέχεια κατεβάζοντας το project από το gitlab, ο υπολογιστής σας είναι configured για να μπορεί να χρησιμοποιήσει το project.

1. Από το command prompt του Node.js, πηγαίνουμε στον φάκελο που κατεβάσαμε το project και τρέχουμε την εντολή `npm install`
1. Εκκίνηση του server εκτελώντας την εντολή `gulp build` στο root path του project μας. Μόλις γίνει η εκκίνηση του server θα ανοίξει ένα νέο tab στον browser στη διεύθυνση http://localhost:3000/. 
Εάν θέλετε να αλλάξετε την διεύθυνση, πριν πραγματοποιήσετε την εκκίνηση αλλάξτε στο αρχείο `gulpfile.js` το πεδίο `BUILD_PORT`. Οποιαδήποτε αλλαγή κάνετε στον κώδικα έχει άμεσο αντίκτυπο στον browser χωρίς να χρειαστεί να κάνετε κάποιο build ή να ανανεώσετε τον browser, όλα γίνονται αυτόματα, είτε η αλλαγή γίνεται σε html, css ή js αρχείο (εκτός από το index.html, το οποίο υπό κανονικές συνθήκες δε χρειάζεται να αλλάξει).

ΣΗΜΕΙΩΣΗ: Αν παρουσιαστούν προβλήματα στη διαδικασία, όπως μηνύματα σφάλματος στη διαδικασία της εγκατάστασης των πακέτων ή μη εγκατάσταση κάποιων πακέτων, είναι πιθανό να οφείλονται σε παλιά έκδοση του Node.js και του NPM. Σ' αυτήν την περίπτωση θα χρειαστεί εγκατάσταση νεότερης έκδοσης από το site [NodeJS](http://nodejs.org/). Το project έχει δοκιμαστεί με τις εξής εκδόσεις: `NodeJS v8.11.4` και `NPM 5.6.0`.


## Coding

Μέσα στο αρχείο `.env` είναι δηλωμένες οι παράμετροι του project και τα διαθέσιμα προφίλ. Στις γενικές παραμέτρους περιλαμβάνεται το όνομα του project και ο αριθμός έκδοσης. Στις παραμέτρους κάθε προφίλ υπάρχει το `baseUrl` του API και μπορούν επίσης να προστεθούν custom παράμετροι, αρκεί να γίνει η αντίστοιχη αλλαγή και στο αρχείο `config.json`.
Η πρόσβαση σ' αυτές τις παραμέτρους από τον κώδικα γίνεται κάνοντας injection του angular constant `ENV_VARS` και λαμβάνοντάς τα ως properties, πχ. `ENV_VARS.baseUrl`.

Τα αρχεία που φορτώνονται από την εκκίνηση της εφαρμογής είναι όλα τα `modules` δηλαδή όσα τελειώνουν σε `.module.js` συν όσα βρίσκονται μέσα στο φάκελο `src/app/_global`.
Όλα τα υπόλοιπα πρέπει να γίνουν lazy loaded όπου απαιτείται.

Η εγκατάστση ενός νέου 3rd party plugin γίνεται μέσω του `npm`. Αν χρειαστεί να προστεθεί plugin εκτός npm, τότε μπαίνει κάτω από το φάκελο `src/vendor/modules/custom_modules`.
Στην περίπτωση που αυτό το plugin κρίνεται απαραίτητο να φορτώνεται από την εκκίνηση της εφαρμογής, τότε το path του αρχείου `.js` πρέπει να προστεθεί στο αρχείο `src/vendor/vendor.scripts.js` και το path του `css` πρέπει να πρστεθεί στο αρχείο `src/vendor/vendor.styles.js`.
Εναλλακτικά, αν θέλουμε να το φορτώνουμε με lazy loading, τότε θα πρέπει να προσθέσουμε τα paths των αρχείων `.js` και `.css` στο αρχείο `src/vendor/vendor.lazy.js`.

Τα css της εφαρμογής βρίσκονται στο φάκελο `src/assets/styles/` και δηλώνονται στο αρχείο `src/assets/styles/app-styles.scss`. Μπορούν να ομαδοποιηθούν ανά ενότητα ανάλογα με τις ανάγκες του κάθε project.

Οι εικόνες βρίσκονται στο φάκελο `src/assets/images` και δηλώνονται στο αρχείο `src/assets/images.js`.

Τα messages βρίσκονται στο φάκελο `src/messages` κάτω από το φάκελο της αντίστοιχης γλώσσας. Μπορούν να δημιουργηθούν αρχεία `.json` για κάθε ενότητα που απαιτείται.

## Εξαγωγή zip

Για να δημιουργηθεί εκτελέσιμη production έκδοση της εφαρμογής η οποία μπορεί να εκτελεστεί απευθείας σε κάποιο web server όπως [Apache](https://httpd.apache.org/) ή [Nginx](http://nginx.org/) και εφ' όσον έχουμε εγκαταστήσει τα dependencies μέσω του ```npm```, εκτελούμε την εντολή `gulp dist --profile=production`

Η εντολή αυτή παράγει ένα αρχείο .zip με τα απαραίτητα αρχεία (minified) στη διαδρομή ```$PROJECTDIR/releases/```. Το όνομα του zip αρχείου αποτελείται από το όνομα του project, τον αριθμό έκδοσης και το επιλεγμένο προφίλ.

Στη θέση του `production` μπορεί να δοθεί κάποιο άλλο από τα προφίλ που είναι δηλωμένα μέσα στο αρχείο `.env`. Επίσης, προαιρετικά μπορεί να δοθεί η παράμετρος `--noMinify` ώστε να μην πραγματοποιηθεί minification των αρχείων.
